---
layout: post
title:  "Unity游戏表格配置方案"
categories: C#
tags: 游戏 Unity 表格 配置
author: zack.zhang
---

* content
{:toc}

## 简介

游戏中通常会用到许多数据，一种是玩家在游戏过程中产生的数据，通常这些数据会被存储到数据库端，客户端需要远程拉取；另一种是设计者为玩家预先设置好的数据，这些数据构建出了整个游戏世界，而且不以玩家实时行为为转移，每一份这种数据都是对游戏某一方面或者某一特性做出的一种描述。本文主要关心的话题是后者，介绍我在游戏开发过程中实现的一套表格数据配置系统。

<!-- more -->
## 技术选型

### 1. 序列化技术

通常序列化技术模型可以分为关系模型和非关系模型。举个例子，采用非关系模型的序列化技术比如xml、JSON等，关系模型的序列化技术比如excel。
那么什么是关系模型呢？关系模型全称关系数据模型，它是以数学中集合论中的关系概念为基础发展起来的。关系模型无论是实体还是实体间的联系均由单一的结构类型——关系来表示。
以下为两种模型的特性及优缺点。

<table>
  <thead>
    <tr>
      <th>类型</th>
      <th>特性</th>
      <th>优点</th>
	  <th>缺点</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>关系模型</td>
      <td>二维表格模型</td>
      <td>1. 容易理解：二维表结构是非常贴近逻辑世界一个概念，关系模型相对网状、层次等其他模型来说更容易理解；<br/>2. 易于维护：<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7/110071?fr=aladdin">数据完整性</a>大大降低了数据冗余和数据不一致的概率；<br/>3. 二维结构易于批量处理数据；</td>
	  <td>1. 为了维护完整性，读写数据量变大；<br/>2. 固定的表结构；</td>
    </tr>
    <tr>
      <td>非关系模型</td>
      <td>键值对存储数据</td>
      <td>1. 基于键值对的存储方式，使数据没有耦合性，容易扩展；<br/>2. 数据不用维护完整性，数据量相对较小，适用于保存海量数据</td>
	  <td>1. 结构复杂，阅读成本高；<br/>2. 难于批量处理数据；</td>
    </tr>
  </tbody>
</table>
在Unity里面，大部分可序列化对象都最终会以非关系模型来保存数据，比如预制体对象（.prefab）、材质对象（.mat）。思考一个问题，如果要批量修改预制体怎么办？也许就需要写一段Editor代码去实现批量操作，成本非常高。再思考一个问题，怎么去阅读一个预制体里的内容？显然直接打开一个文本很不直观，就需要有图形化界面去显示每一个对象的数据。由于设计和数据模型特性，Unity使用非关系模型序列化数据没问题，但是如果要在成本可控范围内去让策划更方便地维护数据，非关系模型显然成本太高。所以本文主要采用关系模型，即Excel表格。

### 2. Excel类型

通常使用Excel的思路有两种：1. 使用电子表格格式（.xls/.xlsx工作表）；2. 使用CSV格式。其中CSV格式由于分隔符不同，分为tab分隔符和逗号分隔符两种格式。

首先来说这两种Excel格式都是被业内比较普遍的使用的，接下来介绍一下两种格式的不同点。

#### 2.1 电子表格格式（.xls/.xlsx工作表）

电子表格格式作为一种二进制格式，通常需要专门的解析工具才能读取文件中的内容。但是如果将其直接应用到游戏里，也就是说将xls直接解析读取到内存中，将会得到很多冗余的信息，浪费内存。因此业内普遍做法如下图所示
![xls flow](https://zd304.github.io/assets/img/xls_flow.png)