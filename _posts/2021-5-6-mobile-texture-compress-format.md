---
layout: post
title:  "Unity移动游戏纹理压缩格式优化"
categories: Unity
tags: 游戏 Unity 优化 贴图
author: zack.zhang
---

* content
{:toc}

移动游戏开发中，性能优化是一个很重要的环节，没有人能在设计之初就想到所有可能发生的事情，并在开发过程中完全避免浪费，这就需要在每一个开发的跌代里去对游戏性能做优化。游戏性能优化通常会针对CPU、渲染、内存去做优化，其中内存优化主要是为了保证游戏运行的稳定性，让更多设备能够运行游戏。内存优化主要是对游戏资源进行优化，这里我们主要讨论对贴图压缩格式的优化，这一点对于2D游戏和UI系统的内存占用至关重要。

<!-- more -->

## 图片文件格式和纹理格式的区别

常用的图片文件格式有BMP，TGA，JPG，GIF，PNG等；

常用的纹理格式有R5G6B5，A4R4G4B4，A1R5G5B5，R8G8B8, A8R8G8B8等。

图片文件格式是图片为了储存信息而使用的，不同的图片文件格式有不同的编码方式。但是图片文件格式是不能直接被GPU识别的，也就是说如果读取的图片是以图片文件格式来进行编码的，那么就需要将这些图片解码成GPU识别的格式，再传送到GPU。游戏引擎通常直接使用能被GPU识别的格式来保存图片。

例如Unity中使用图片时，无论导入的是什么样的图片，最终都会根据平台的不同转换成不同的纹理格式。

![unity_compressd_list](https://zd304.github.io/assets/img/fxaa/unity_compressd_list.png)<br/>

## 像素深度

像素深度对应的英文名为bits per pixel，简称bpp。从英文名上更直观地可以了解到，像素深度其实描述的是每个像素在内存中占用多少字节。例如ARGB32的像素深度就是32bpp，因为每个像素为R、G、B、A分别分配了8bit的空间，所以像素深度 = 8 + 8 + 8 + 8 = 32。

## 常用纹理压缩格式

对于ARGB32的纹理来说，一张1024\*1024大小的贴图，所占的内存空间为1024\*1024\*32/8 = 4,194,304 ≈ 4MB。游戏中会大量用到这么大尺寸的贴图，甚至还有很多更大的贴图，如此大量的贴图，如果都用ARGB32显然是不明智的。

那么有没有什么格式是像png、jpg这种经过压缩而又能最大程度保持原图效果的格式呢？答案是有的。常用的纹理压缩格式有ETC1、ETC2、PVRTC、ASTC等。

## 纹理压缩格式对比

<table>
  <thead>
    <tr>
      <th>压缩格式</th>
      <th>像素深度</th>
      <th>图像效果</th>
	  <th>适配性</th>
	  <th>GL扩展名</th>
	  <th>使用说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ETC1</td>
      <td>4bpp</td>
      <td>★★</td>
	  <td>支持OpenGL ES 2.0的设备上</td>
	  <td></td>
	  <td></td>
    </tr>
    <tr>
      <td>ETC2-RGB</td>
      <td>4bpp</td>
      <td>★★</td>
	  <td></td>
	  <td></td>
	  <td></td>
    </tr>
  </tbody>
</table>